"use strict";var f=Object.defineProperty;var A=(i,e,t)=>e in i?f(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var u=(i,e,t)=>(A(i,typeof e!="symbol"?e+"":e,t),t);class c{constructor(){u(this,"handlers",[])}on(e){this.handlers.push(e)}off(e){this.handlers=this.handlers.filter(t=>t!==e)}offAll(){this.handlers=[]}async trigger(e){const t=this.handlers.slice(0).map(async a=>a(e));await Promise.all(t)}}const p={lastUpdate:Date.now(),tick(i=10){const e=Date.now();return e-this.lastUpdate>1e3/i?(this.lastUpdate=e,!0):!1}},l=()=>({changed:new c,pressed:new c,released:new c,repeat:new c}),b={init(i){const e={id:i.index,buttons:i.buttons.length,axes:Math.floor(i.axes.length),axeValues:[],axeStep:.15,triggerTrim:.05,hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:i.mapping,buttonActions:{},axesActions:{},pressed:{},vibrate(t=.75,a=500){if(this.hapticActuator)switch(this.vibrationMode){case 0:return this.hapticActuator.pulse(t,a);case 1:return this.hapticActuator.playEffect("dual-rumble",{duration:a,strongMagnitude:t,weakMagnitude:t})}},checkStatus(){let t={};const a=p.tick(),n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(n.length){if(t=n[this.id],t.buttons)for(let s=0;s<this.buttons;s++){if(a&&t.buttons[s].value!==void 0&&t.buttons[s].value>0){const r=t.buttons[s].value<this.triggerTrim?0:t.buttons[s].value;this.buttonActions[s].repeat.trigger(r)}t.buttons[s].pressed?this.pressed[`button${s}`]||(this.pressed[`button${s}`]=!0,this.buttonActions[s].pressed.trigger(1),this.buttonActions[s].changed.trigger(1)):this.pressed[`button${s}`]&&(t.buttons[s].pressed||this.buttonActions[s].changed.trigger(0),delete this.pressed[`button${s}`],this.buttonActions[s].released.trigger(0),this.buttonActions[s].repeat.trigger(0))}if(t.axes)for(let s=0;s<this.axes;s++){const r=Math.floor(s/2),h=s%2===0?"horizontal":"vertical";let o=t.axes[s]??0;Math.abs(t.axes[s])<=this.axeStep&&(o=0),Math.abs(this.axeValues[s])>this.axeStep?(o===0||a)&&this.axesActions[r][h].repeat.trigger(o):a&&Math.abs(o)>this.axeStep&&this.axesActions[r][h].repeat.trigger(o),o===0&&this.axeValues[s]!==0?(this.axesActions[r][h].changed.trigger(o),this.axesActions[r][h].released.trigger(o),this.axeValues[s]=o):Math.abs(this.axeValues[s]-o)<this.axeStep||(this.axeValues[s]===0?(this.axesActions[r][h].changed.trigger(o),this.axesActions[r][h].pressed.trigger(o),this.axeValues[s]=o):(this.axesActions[r][h].changed.trigger(o),this.axeValues[s]=o)),o===0&&(this.axeValues[s]=0)}}},on(t,a,n="changed"){if(t<0){const s=Math.floor((Math.abs(t)-1)/2),r=(Math.abs(t)-1)%2===0?"horizontal":"vertical";this.axesActions[s][r][n].on(a)}else this.buttonActions[t][n].on(a);return this},off(t){if(t<0){const a=Math.floor((Math.abs(t)-1)/2),n=(Math.abs(t)-1)%2===0?"horizontal":"vertical";this.axesActions[a][n].changed.offAll(),this.axesActions[a][n].pressed.offAll(),this.axesActions[a][n].released.offAll(),this.axesActions[a][n].repeat.offAll()}else this.buttonActions[t].changed.offAll(),this.buttonActions[t].pressed.offAll(),this.buttonActions[t].released.offAll(),this.buttonActions[t].repeat.offAll();return this}};for(let t=0;t<e.buttons;t++)e.buttonActions[t]=l();for(let t=0;t<e.axes;t++)e.axesActions[t]={vertical:l(),horizontal:l()};return i.hapticActuators?typeof i.hapticActuators.pulse=="function"?(e.hapticActuator=i.hapticActuators,e.vibrationMode=0,e.vibration=!0):i.hapticActuators[0]&&typeof i.hapticActuators[0].pulse=="function"&&(e.hapticActuator=i.hapticActuators[0],e.vibrationMode=0,e.vibration=!0):i.vibrationActuator&&typeof i.vibrationActuator.playEffect=="function"&&(e.hapticActuator=i.vibrationActuator,e.vibrationMode=1,e.vibration=!0),e.axeValues=[...i.axes],e}};exports.LiteEvent=c;exports.gamepad=b;
